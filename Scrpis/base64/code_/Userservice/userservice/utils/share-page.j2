<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="/static/css/iconfont.css" />
  <link href="{{WEB_HOST}}/ss/css/notebookshare_v2.css?v=20170803001" rel="stylesheet" />
  <link href="{{WEB_HOST}}/static/css/s.css?v=20170803001" rel="stylesheet" />  
  <link href="{{WEB_HOST}}/istatic/mlstudio/static/css/jquery.dataTables.min.css" rel="stylesheet" />
  <link href="{{WEB_HOST}}/istatic/mlstudio/static/css/fx.css?labv=3.0.249.6&amp;origin=mydev" rel="stylesheet" type="text/css">
  <link href="{{WEB_HOST}}/istatic/mlstudio/static/css/style.css?labv=3.0.249.6&amp;origin=mydev" rel="stylesheet" type="text/css">
  <title>{{TITLE}} - {{SITE_NAME}}</title>
  <style>
    /* TODO move thos to some css file */
    html,
    body {
      margin: 0;
      padding: 0;
    }

    .hljs-comment,
    .hljs-doctag {
      font-style: normal;
      font-family: Consolas, Menlo, Monaco, "Lucida Console", "Liberation Mono", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Courier New", sans-serif, monospace;
    }

    .notebooksharecontainer .bigchart .tabtitle {
      display: flex;
      align-items: center;
    }

    .notebooksharecontainer pre {
      /* white-space: pre; */
      line-height: 20px;
    }

    html body code,
    html body pre {
      font-family: Consolas, Menlo, Monaco, "Lucida Console", "Liberation Mono", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Courier New", sans-serif, monospace;
      line-height: 22px;
    }

    html .notebooksharecontainer code,
    html .notebooksharecontainer kbd,
    html .notebooksharecontainer pre,
    html .notebooksharecontainer samp {
      font-family: Consolas, Menlo, Monaco, "Lucida Console", "Liberation Mono", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Courier New", sans-serif, monospace;
      line-height: 22px;

    }

    body blockquote {
      padding: 12px;
    }

    body ol {
      padding: 0 0 0 40px;
    }

    body ol p {
      margin: 15px 0;
    }

    div.cooked {
      padding: 12px;
    }

    div.cooked div.notebooksharecontainer {
      margin: auto;
    }

    @media only screen and (min-width: 768px) {
      div.cooked .notebooksharecontainer {
        max-width: 100%;
      }

      .notebooksharecontainer .notebookclonewrapper {
        /* float:left; */
      }

      .notebooksharecontainer div.input_area {}

      div.topic-body .contents .cooked {
        overflow: visible
      }

      div.notebooksharecontainer .notebookclone.btn.btn-primary {
        /* margin-right: 25px; */
      }

      .notebooksharecontainer .expand-btn {
        /* position: absolute;
        right: 0; */
        display: inline-block;
        height: 8px;
        width: 12px;
        background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAPElEQVR4AWMYPKDgTMHMAgYghLIQEMZIK/gPlUCwEArgEqsKBBEsNAVQiTMIFkEFBK0gyZH4vYkJ6awAAOTScYHXEeq7AAAAAElFTkSuQmCC');
        background-position: center center;
        background-repeat: no-repeat;
        cursor: pointer;
      }

      .notebooksharecontainer.expanded {
        width: 140%;
      }

      .notebooksharecontainer.expanded .expand-btn {
        background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAPElEQVR4AWMYbKBgZsGZAgYQRLDABFzwf0EagoWqQLBgFUQQwUJVcAYqiGARVkDQCqIdiYD4vYkJ6aYAANjUcDFHA4gKAAAAAElFTkSuQmCC');
      }

      .hidetimeline .timeline-scrollarea-wrapper {
        display: none;
      }

      div.cooked pre {
        overflow: visible;
        /* white-space: pre-wrap;
        word-wrap: break-word; */
      }

      div.cooked pre code.hljs:hover {
        width: 140%;
      }
    }

    .extra-info .list-vote-count {
      display: none;
    }

    .ml-studio {
      height: 700px;
      position: relative;
      margin-bottom: 5px;
    }

    #ml_studio_json {
      display: none;
    }

    .tabcontent {
      height: 97%;
    }

    #aux-foreground {
      box-shadow: none;
    }

    h1.itemtitle {
      display: none;
    }

    #dagSearchTextBox input {
      padding: unset;
      padding-left: 5px;
      margin-bottom: 0px;
    }

    #controlPanel input {
      width: auto;
      display: inline-block;
    }

    .voting-wrapper {
      display: none;
    }
  
    .notebooksharecontainer ul.kpi {
      padding-left: 0px;
    }

    .notebooksharecontainer span.title {
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }

    div.output_png.output_subarea img {
      max-height: 5500px;
    }

    .lz_overlay_chat_footer {
      display: none;
    }

    .m-modal-container {
      width: auto !important;
      max-width: 420px;
    }

    .m-modal-container,
    .m-modal-container * {
      box-sizing: border-box;
    }

    .m-bigquant-signup input {
      outline: none !important;
      box-shadow: none !important;
      border-radius: 0 !important;
    }


    .packupButton.packupButton3 {
      padding-top: 31.5px;
      padding-bottom: 18px;
    }

    .packupButton {
      position: relative;
      padding-top: 16px;
      padding-bottom: 18px;
    }

    .contentPadding {
      padding: 0 17px;
    }

    .gradient {
      position: absolute;
      top: -159px;
      left: 0;
      height: 160px;
      width: 100%;
      background-image: -webkit-gradient(linear, left top, left bottom, from(rgba(255, 255, 255, 0)), to(#fff));
      background-image: linear-gradient(-180deg, rgba(255, 255, 255, 0), #fff);
    }

    .gradient .packupArrow {
      display: block;
      width: 16px;
      height: 16px;
      position: absolute;
      -webkit-animation: packupArrowFlow 1s ease infinite;
      animation: packupArrowFlow 1s ease infinite;
      bottom: 0;
      left: 50%;
      margin-left: -8px;
      font-size: 2.5em;
      color: #ec5645;
      cursor: pointer;
    }

    .openall3 {
      border: 0;
      -webkit-border-radius: 3px;
      border-radius: 3px;
      height: 42px;
      width: 99.7%;
      line-height: 42px;
      display: inline-block;
      cursor: pointer;
    }

    .openall2,
    .openall3 {
      color: #fff;
      background-color: #ec5645;
      text-align: center;
    }

    .list-vote-count {
      margin-top: 0;
    }

    #ml_studio_json+div.input {
      max-height: 400px;
      overflow: scroll;
    }

    /* 自定义OutputArea样式 */
    #ml_studio_json+div.input {
      border: 1px solid #cfcfcf;
      border-radius: 2px;
    }

    .jp-OutputArea-log-header {
      background: #f6f6f6;
      height: 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 14px;
      color: #666;
    }

    .jp-OutputArea-log-header-title {
      font-family: Helvetica Neue, Helvetica, PingFang SC, Hiragino Sans GB, Microsoft YaHei, \\5FAE\8F6F\96C5\9ED1, Arial, sans-serif;
      cursor: pointer;
      user-select: none;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .jp-OutputArea-log-content {
      padding: 0 6px;
      overflow-x: auto;
      font-size: 13px;
      color: #333;
      line-height: 1.8;
    }

    .jp-OutputArea-log-content .jp-OutputArea-log-item:first-child {
      margin-top: 12px;
    }

    .jp-OutputArea-log-content .jp-OutputArea-log-item:last-child {
      margin-bottom: 12px;
    }

    .jp-OutputArea-log {
      margin-bottom: 12px;
      border: 1px solid #cfcfcf;
    }

    .jp-OutputArea-log.jp-OutputArea-log-fold .jp-OutputArea-log-content {
      max-height: 200px;
      overflow-y: scroll;
    }

    /* .jp-OutputArea-log.jp-OutputArea-log-unfold .jp-OutputArea-log-content {
} */

    .jp-OutputArea-log .jp-OutputArea-log-item {
      margin: 0 auto;
      background-color: transparent;
      border: none;
      padding: 0;
    }

    .jp-OutputArea-log .arrow {
      width: 16px;
      margin-left: 4px;
      height: 16px;
      transform-origin: 50% 50%;
      background-size: 16px 16px;
      background-repeat: no-repeat;
      background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTQ4ODE4MDE0NzAzIiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjM4MzIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iNjQiIGhlaWdodD0iNjQiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUwMy4xMzgxNjggNzcwLjQxNjUzOGMtMTUuMjM4MDUzIDAtMzAuNDc2MTA1LTUuODE2NDcyLTQyLjEwOTA1LTE3LjQ0ODM5NEw4MC45MjYxMjQgMzcyLjg2NTE0OWMtMjMuMjY0ODY2LTIzLjI2NDg2Ni0yMy4yNjQ4NjYtNjAuOTUzMjM0IDAtODQuMjE3MDc3IDIzLjI2NDg2Ni0yMy4yNjQ4NjYgNjAuOTUzMjM0LTIzLjI2NDg2NiA4NC4yMTcwNzcgMGwzMzcuOTkzOTQ0IDMzNy45OTM5NDQgMzU0LjEyNDMyLTM1NC4wODU0MzRjMjMuMjY0ODY2LTIzLjI2NDg2NiA2MC45NTMyMzQtMjMuMjY0ODY2IDg0LjIxNzA3NyAwIDIzLjI2NDg2NiAyMy4yNjQ4NjYgMjMuMjY0ODY2IDYwLjk1MzIzNCAwIDg0LjIxNzA3N0w1NDUuMjQ3MjE4IDc1Mi45NjgxNDRDNTMzLjYxNDI3NCA3NjQuNjAxMDg4IDUxOC4zNzYyMjEgNzcwLjQxNjUzOCA1MDMuMTM4MTY4IDc3MC40MTY1Mzh6IiBwLWlkPSIzODMzIiBmaWxsPSIjOTU5NTk1Ij48L3BhdGg+PC9zdmc+);
    }

    .jp-OutputArea-log.jp-OutputArea-log-unfold .arrow {
      transform: rotate(180deg);
    }

    .jp-OutputArea-log.jp-OutputArea-log-fold .arrow {
      transform: rotate(0);
    }

    .jp-OutputArea-log-item .success {
      color: #4F8A10;
      background-color: #DFF2BF;
    }

    /* .jp-OutputArea-log-item .info {
  color: #00529B;
  background-color: #BDE5F8;
} */

    .jp-OutputArea-log-item .warning {
      color: #9F6000;
      background-color: #FEEFB3;
    }

    .jp-OutputArea-log-item .error {
      color: #D8000C;
      background-color: #FFD2D2;
    }

    .jp-OutputArea-log-item .exception {
      color: #D8000C;
      background-color: #FFD2D2;
    }

    .jp-OutputArea-log-item .debug {
      color: #888888;
      background: #e4e4e4;
    }

    .jp-color-red {
      color: #DD2F23;
    }

    .fa-bookmark:before {
      content: "\f005"
    }

    .user-table .user-archive {
      display: none;
    }

    .nav-stacked>span>li {
      border: none;
    }

    .nav-stacked>span>li>a,
    .nav-stacked>span>li>li>a {
      border: 1px solid #d9d9d9;
      border-bottom: none;
      color: #6d6d6d;
    }

    .nav-stacked>span>li:last-of-type>a {
      border-bottom: 1px solid #d9d9d9;
    }

    .nav-stacked>span>li>li:first-of-type>a {
      border-top: none;
    }

    .themes-list-header .tab {
      margin-left: 0;
    }

    .user-navigation .nav-stacked li.archive {
      padding-left: 0;
    }

    @media screen and (max-width: 414px) {
      div#lz_overlay_wm {
        margin: 0px 17px 88px 0px !important;
      }
    }

    /* 修复图片变形 */
    .lightbox-wrapper img {
      object-fit: cover;
      object-position: top;
    }


    /* 资源外链需要登录才可访问 */
    article .cooked a>ruby>ruby {
      display: none;
    }

    /* 隐藏因此徽章人数 */
    .user-badges .clearfix a {
      display: none;
    }

    section#main {
      top: 0px !important;
    }

    a.widget-link {
      color: #0582b6;
    }

    a.d-link {
      color: #0582b6;
    }

    a.search-link {
      color: #0582b6;
    }

    .presentation-start-play-btn {
      margin-left: 15px;
      color: #ec5645;
    }

    /* 因子研究 */
    .output_html.rendered_html.output_subarea .type_title_left {
      font-size: 18px;
    }

    .output_html.rendered_html.output_subarea .type_title_left p {
      margin: 0 0 1em;
      text-align: left;
      padding: 0 4px 0 10px;
      font-weight: 700;
      position: relative;
    }

    .output_html.rendered_html.output_subarea .type_title_left span {
      color: #9ea3a6;
      font-weight: normal;
      font-size: 15px;
    }

    .output_html.rendered_html.output_subarea .type_title_left p::before {
      content: '';
      position: absolute;
      width: 4px;
      height: 100%;
      background: #E74C3C;
      transform: translate(-10px, 0);
    }

    .output_html.rendered_html.output_subarea .factor_table {
      border-collapse: collapse;
      border-spacing: 0;
      border: none;
      font-size: 12px;
      table-layout: fixed;
      margin: 0 0 1em 0;
      width: 100%;
    }

    .output_html.rendered_html.output_subarea .factor_table tr {
      border-top: 1px solid #ebebeb;
    }

    .output_html.rendered_html.output_subarea .factor_table tr {
      line-height: 2.2em;
      font-size: 14px;
      color: #333;
      text-align: right;
      vertical-align: middle;
      padding: 0.5em 0.5em;
      white-space: normal;
      max-width: none;
      border: none;
    }

    .output_html.rendered_html.output_subarea .factor_table tr th {
      font-weight: 400;
      text-align: right;
      border: none;
      background-color: #fff;
    }

    .output_html.rendered_html.output_subarea .factor_table tr td {
      max-width: 100px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      text-align: right;
      vertical-align: middle;
      padding: 0.5em 0.5em;
      line-height: normal;
      border: none;
    }

    .output_html.rendered_html.output_subarea .factorlens-title {
      width: 100%;
      margin: 15px auto 20px;
      font-size: 24px;
      text-align: center;
    }

    .output_html.rendered_html.output_subarea .factor_table .pct.up {
      color: red;
    }

    .output_html.rendered_html.output_subarea .factor_table .pct.down {
      color: green;
    }

    .output_html.rendered_html.output_subarea .cols {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      margin-bottom: 54px;
      box-sizing: border-box;
    }

    .output_html.rendered_html.output_subarea .col {
      box-sizing: border-box;
      width: 100%;
      margin: 0 10px;
    }

    .output_html.rendered_html.output_subarea .highcharts-container {
      width: 100% !important;
    }

    .output_html.rendered_html.output_subarea .ic_summary {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #F8F8F9;
      width: 100%;
      padding: 24px 50px;
      margin-bottom: 54px;
      box-sizing: border-box;
    }

    .output_html.rendered_html.output_subarea .ic_summary .item {
      color: #888888;
      font-size: 14px;
    }

    .output_html.rendered_html.output_subarea .ic_summary p {
      color: #333333;
      font-size: 24px;
      margin: 4px 0 0;
    }

    .output_html.rendered_html.output_subarea .factorlens-stocks-wrapper .factor_table.stocks tbody {
      border-top: 1px solid #ebebeb;
    }

    .output_html.rendered_html.output_subarea .factorlens-stocks-wrapper .factor_table.stocks tbody tr:nth-child(even) {
      background-color: rgba(245, 245, 245, 1);
    }

    html body #reply-control .d-editor-preview img:not(.thumbnail),
    html body .cooked img:not(.thumbnail) {
      max-width: 690px;
      max-height: 2000px;
    }

    /* 表格导航按钮 */
    .cooked .notebooksharecontainer .nav-tabs > li > a {
      color: rgba(0, 0, 0, .65);
      border: 1px solid #ddd;
      border-bottom: none;
    }
    .cooked .notebooksharecontainer .nav-tabs > li.active > a,
    .cooked .notebooksharecontainer .nav-tabs > li.active > a:hover,
    .cooked .notebooksharecontainer .nav-tabs > li.active > a:focus {
      color: #EC3825;
      border-bottom: none;
    }

    /* 新增样式 */
    .cooked .notebooksharecontainer .bq-tabs-table .nav-tabs {
      display: flex;
      flex-direction: column;
      max-height: 200px;
      overflow: auto;
      border: none;
    }
    .cooked .notebooksharecontainer .bq-tabs-table .nav-tabs li {
      display: flex;
      align-items: center;
      margin: 0;
      height: 40px;
      max-height: 40px;
    }
    .cooked .notebooksharecontainer .bq-tabs-table .nav-tabs li:hover {
      background-color: #eeeeee;
    }
    .cooked .notebooksharecontainer .bq-tabs-table .nav-tabs li a {
      border: none;
      flex: 0 0 200px;
      text-align: center;
      white-space: nowrap;
    }
    .cooked .notebooksharecontainer .bq-tabs-table .nav-tabs > li.active > a,
    .cooked .notebooksharecontainer .bq-tabs-table .nav-tabs > li.active > a:hover,
    .cooked .notebooksharecontainer .bq-tabs-table .nav-tabs > li.active > a:focus {
      border: none;
      background: transparent;
      cursor: pointer;
    }
    .cooked .notebooksharecontainer .bq-tabs-table .nav-tabs li span {
      flex: 1 1 auto;
      text-align: center;
      padding: 0 5px;
    }
    .cooked .notebooksharecontainer .bq-tabs-table .nav-tabs > li.active {
      color: #EC3825;
    }

    /* 表格内容 */
    .kpicontainer .kpi li{
      flex: 0 0 calc(100% * 1 / 6);
      margin-bottom: 10px;
    }
    .kpicontainer .kpi span.title {
      height: auto;
    }
    .kpicontainer .kpi span.value {
      font-weight: bold;
    }
    table.dataTable tbody td {
      text-align: center !important;
      white-space: nowrap;
    }
    table.dataTable thead th {
      white-space: nowrap;
      text-align: center;
    }
    .table.dataTable #输出日志 td:last-child {
      white-space: normal;
    }

    /* 表格底部按钮 */
    .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
      background: rgba(236,56,37,0.6);
      border-color: transparent;
    }
    .dataTables_wrapper .dataTables_paginate .paginate_button.current,
    .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
      background: #EC3825;
      color: white !important;
      border-color: transparent;
    }

    /* 日志输出区域 */
    div.output_area div.output_text {
      max-height: 500px;
      overflow-y: auto;
    }
    /* 表格tab样式在小屏幕上的样式 */
    @media only screen and (max-width: 737px) {
      .cooked ul.nav.nav-tabs {
        display: flex;
        overflow-x: auto;
        flex-wrap: nowrap;
        white-space: nowrap;
      }
      .cooked .notebooksharecontainer .nav-tabs > li {
        margin: 0;
      }
      .cooked .kpicontainer .kpi li {
        flex: 0 0 calc(100% * 1 / 4);
      }
    }
  </style>

</head>

<body>
  <div class="regular contents">
    <div class="cooked">
      {{CONTENT}}
    </div>
  </div>
  <input id="copy_content" type="text" value=""  style="position: absolute;top: 0;left: 0;opacity: 0;z-index: -10;"/>
  <!-- TODO: refactor the code below -->

  <script src="{{WEB_HOST}}/static/vendor/jquery/jquery-3.3.1.min.js"></script>
  <script src="{{WEB_HOST}}/istatic/mlstudio/static/js/jquery.dataTables.min.js"></script>
  <script src="{{WEB_HOST}}/ss/vendor/JSEncrypt/jsencrypt.min.js"></script>
  <script src="{{WEB_HOST}}/static/vendor/vue/vue-2.5.22.min.js?2020050701"></script>
  <script src="{{WEB_HOST}}/istatic/mlstudio/static/js/highstock.js" type="text/javascript" charset="utf-8"></script>
  <script src="{{WEB_HOST}}/istatic/mlstudio/static/js/highcharts-more.js" type="text/javascript" charset="utf-8"></script>
  <script src="{{WEB_HOST}}/istatic/mlstudio/static/js/heatmap.js" type="text/javascript" charset="utf-8"></script>
  <script src="{{WEB_HOST}}/ss/js/bigcharts.js?v=1"></script>
  <script src="{{WEB_HOST}}/ss/js/d3.v4.10.0.min.js?v=201707231829"></script>
  <script src="{{WEB_HOST}}/ss/js/d3tree.js?v=201707231829"></script>
  <script src="{{WEB_HOST}}/istatic/mlstudio/static/js/codemirror.5.24.2/codemirror.js"></script>
  <script src="{{WEB_HOST}}/istatic/mlstudio/static/js/codemirror.5.24.2/python.js"></script>
  <script src="{{WEB_HOST}}/istatic/mlstudio/static/js/codemirror.5.24.2/show-hint.js"></script>
  <script>
    window.codeMirror = CodeMirror;
    window.site_conf = {
      is_community_edition: true
    }

    function clickFactor() {
      document.addEventListener('click', function (e) {
        var factor_nav = document.querySelectorAll('.bigchart.display > .nav-tabs');
        if (factor_nav && factor_nav.length > 0) {
          factor_nav[0].addEventListener('click', function (e) {
            var factor_parent = e.target.parentNode;
            var factor_id = e.target.text;
            if (factor_id) {
              var factor_oldParent = document.querySelector('.bigchart.display > .nav-tabs >li.active');
              if (factor_parent !== factor_oldParent) {
                var factor_oldContent = document.querySelector('.bigchart.display > .tab-content >div.active');
                var factor_content = document.querySelector('#' + factor_id);
                factor_oldParent.className = '';
                factor_oldContent.className = 'tab-pane';
                factor_parent.className = 'active';
                factor_content.className = 'tab-pane active';
              }
            }
          }, { once: true });
        }
      });
    }
    clickFactor();
  </script>

  <script>

    setInterval(function () {
      $('.cooked .notebooksharecontainerinitial').each(function (i, e) {
        e = $(e);
        e.removeClass("notebooksharecontainerinitial");
        $('.bigchart ul.nav li > a', e).removeAttr('href');

        $('div.notebookshare-inlineimg', e).each(function (j, div) {
          div = $(div);
          div.replaceWith('<img src="' + div.attr('data-content') + '">');
        });

        $('div.notebookshare-highcharts', e).each(function (j, div) {
          div = $(div);
          var url = div.attr('data-content');
          var cid = "notebookshare-highcharts-" + Math.random().toString(36).substring(7);

          $.getJSON(url, function (data) {
            if (!data['__type'] || data['type'] == 'chart') {
              div.replaceWith('<div class="bigchart" id="' + cid + '"></div>');
              if (data['stock']) { Highcharts.stockChart(cid, data); } else { Highcharts.chart(cid, data); }
            } else if (data['__type'] == 'tree') {
              div.replaceWith('<div class="bigchart tree" id="' + cid + '"></div>');
              d3tree_plot(data, cid);
            } else if (data['__type'] == 'tabs') {
              div.replaceWith('<div class="bigchart" id="' + cid + '"></div>');
              var chart_id = data['__id'];
              $('#' + chart_id).show();
              $('#' + chart_id + '>.nav>li').bind("click", function () {
                var pane_id = $(this).find('a')[0].innerHTML;
                $(this).siblings().removeClass("active");
                $(this).addClass("active");
                $(this).parent().parent().find(".tab-pane").removeClass("active");
                $(this).parent().parent().find(".tab-pane[id=" + pane_id + "]").addClass("active");
              });
            } else if (data['__type'] == 'datatable') {
              var chart_id = data['__id'];
              data['language'] = {
                "sProcessing": "处理中...",
                "sLengthMenu": "显示 _MENU_ 项结果",
                "sZeroRecords": "没有匹配结果",
                "sInfo": "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
                "sInfoEmpty": "显示第 0 至 0 项结果，共 0 项",
                "sInfoFiltered": "(由 _MAX_ 项结果过滤)",
                "sInfoPostFix": "",
                "sSearch": "搜索:",
                "sUrl": "",
                "sEmptyTable": "表中数据为空",
                "sLoadingRecords": "载入中...",
                "sInfoThousands": ",",
                "oPaginate": {
                  "sFirst": "首页",
                  "sPrevious": "上页",
                  "sNext": "下页",
                  "sLast": "末页"
                }
              }
              // 页面存在多个分享notebook时可能有相同 chart_id 的table
              $(div).parent().find('#' + chart_id).DataTable(data);
            }
          });
        });

        $('.notebookclonewrapper > .notebookclone', e).each(function (j, div) {
          div = $(div);
          var notebook = "{{NOTEBOOK}}";
          div.click(function() {
            $.ajax({
            type: "POST",
            url: '/api/userservice/clone',
            data: JSON.stringify({
              "notebook": notebook,
              "name": "{{TITLE}}"
            }),
            success: function (e) {
              console.log('success', e)
              window.location.href = e.data
            },
            contentType: 'application/json'
          });
          })
            // div.append('<form style="display:none" method="post" target="_blank" action="/proxy/experimentshare/clone" id="form-__SHARE_ID__"><input type="hidden" name="share_id" value="__SHARE_ID__"></form>'.replace(
            //  /__SHARE_ID__/g, div.attr('data-content')));
            //  div.click(function () {
            // try {
            //   var ps = require('preload-store').default;
            //   gtag('event', 'clone_community', {
            //     'event_category': ps.get('currentUser') ? 'yes' : 'no',
            //     'event_label': $('.fancy-title').text().trim(),
            //   })
            // } catch (err) {
            //   console.info(err)
            // }
            // $('form', div).submit();
          // });
          var expand_btn = $('<a class="expand-btn" title="展开/收起" ></a>');
          div.after(expand_btn);
          expand_btn.click(function (e) {
            $(e.target).parent().parent().toggleClass('expanded');
            $('#main').toggleClass('hidetimeline');

            if (typeof Highcharts !== 'undefined' && Highcharts.charts) {
              for (var i = 0; i < Highcharts.charts.length; i++) {
                var chart = Highcharts.charts[i];
                if (!chart || !chart.renderTo || chart.renderTo.clientWidth <= 100 || chart.renderTo.clientWidth == chart.chartWidth) {
                  continue;
                }
                chart.reflow();
              }
            }
          });
        });
      });
    }, $('.d-editor-preview').length > 0 ? 3000 : 2000);
  </script>

  <script>
    window.siteConf = window.BigQuant = {
      labVersion: "2.0.927.11",
      // TODO: fix this
      subHost: "community",
      mainJs: "{{WEB_HOST}}/istatic/mlstudio/static/js/main.js",
      staticBaseUrl: "/istatic/",
      webHostUrl: "/",
      studioHostUrl: "/",
      outUserBox: true
    };
  </script>
  <script type="text/javascript" src="{{WEB_HOST}}/istatic/mlstudio/static/js/vendor.js?labv=2.0.249.7b&origin=mydev" crossorigin="anonymous"></script>
  <script type="text/javascript" src="{{WEB_HOST}}/istatic/mlstudio/static/js/config.js?labv=2.0.249.7b&origin=mydev"></script>

  <script type="text/javascript">
    function copyurl(){
      var inputElement =  document.getElementById("copy_content");
      inputElement.value = location.href;
      inputElement.select();
      document.execCommand("Copy");
      document.getElementById('btn_copyurl').innerText = '复制成功';
    }

    function bind_toggle_fold_output() {
      $(document).bind('click', function (e) {
        if ($(e.target).hasClass('jp-OutputArea-log-header-title') ||
          $(e.target).parents('.jp-OutputArea-log-header-title').length
        ) {
          var $outputArea = $(e.target).parents('.jp-OutputArea-log');
          if ($outputArea.hasClass('jp-OutputArea-log-fold')) {
            $outputArea.removeClass('jp-OutputArea-log-fold').addClass('jp-OutputArea-log-unfold');
          } else {
            $outputArea.removeClass('jp-OutputArea-log-unfold').addClass('jp-OutputArea-log-fold');
          }
        }
      })
    }


    function navTabsInit(){
      $('ul.nav-tabs li a').each(function(){
        $(this).parent().css('cursor','pointer')
        $(this).parent().bind('click',function(){
          var li = $(this);
          var pane = li.find("a")[0];
          var pane_id = $(pane).text();
          li.siblings().removeClass("active");
          li.addClass("active");
          li.parent().parent().find(".tab-pane").removeClass("active");
          li.parent().parent().find(".tab-pane[id=" + pane_id + "]").addClass("active");
        })
      })
    }
    let navTabsFlag= false
    setInterval(function(){
      if(navTabsFlag) return
      let length = $('ul.nav-tabs li a').length
      if(length>0){        
        navTabsInit()
        navTabsFlag = true
      }
    },1500)

    bind_toggle_fold_output();

    function bigquant_ml_loop() {
      var sleep = 3000;
      if ($('.ml-studio').length > 0) {
        if ($('.fxshell-pivotlist-panel').length <= 0 || $('#ExperimentEditor')[0].innerHTML == "") {
          if (typeof Shell != "undefined" && !window.isRendering) {
            $('.ml-studio')[0].style.height = 600 + 'px';
            Shell.UI.Navigation.navigate('#Workspace/Experiments/Experiment/Draft/ViewExperiment');
          } else {
            sleep = 2000;
          }
        } else {
          return;
        }
      }
      setTimeout(bigquant_ml_loop, sleep);
      // 隐藏页面元素
      $('.expand-btn').remove()
      $('.bq-template-label-inject').remove()
    }
    bigquant_ml_loop();

    $(document).ready(function(){
      window.parent.postMessage({ "experimentshareHeight": window.document.body.scrollHeight }, "*")
    })
    

    new ResizeObserver(entries =>{
      window.parent.postMessage({ "target": "experimentShareFrameObserver" }, "*")
      window.parent.postMessage({ "experimentshareHeight": window.document.body.scrollHeight }, "*")
    } ).observe(document.body);
  </script>
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
  </script>
  <script src="{{WEB_HOST}}/static/js/polyfill.min.js"></script>
  <script id="MathJax-script" async src="{{WEB_HOST}}/istatic/mlstudio/static/js/tex-mml-chtml.js"></script>
</body>

</html>
